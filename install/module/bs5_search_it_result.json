{"id":11,"key":"bs5.search_it.result","name":"translate:module.bs5.search_it.result","output":"<?php\n\nuse Alexplusde\\BS5\\Fragment;\nuse Alexplusde\\BS5\\Helper;\n\n\/* Ben\u00f6tigte Addons *\/\n$requiredAddons = ['search_it'];\nif (!Helper::packageExists($requiredAddons)) {\n    echo rex_view::error(rex_i18n::rawMsg('bs5_missing_addon', implode(', ', $requiredAddons)));\n    return;\n};\n\n\/* Instruktionen *\/\nHelper::showBackendUserInstruction(\"F\u00fcr die Suchfunktion wird ein aktueller Index der Seite im Add-on 'search_it' ben\u00f6tigt.\", Helper::getBackendPageLink('search_it'));\n\n?>\n<?php\n# Legacy Modul\n        $server = rtrim(rex::getServer(), \"\/\");\n$request = rex_request('search', 'string', false);\n        \nif ($request) {\n    $search_it = new search_it();\n    $result = $search_it->search($request);\n            \n    if ($result['count']) {\n        echo '<h2 class=\"search_it-label\">{{ search_it:results }}: '.$result['count'].'<\/h2>';\n                \n        echo '<ul class=\"search_it-results\">';\n        foreach ($result['hits'] as $hit) {\n            if ($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'article') {\n                $text = $hit['article_teaser'];\n            } else {\n                $text = $hit['highlightedtext'];\n            }\n                    \n            \/* Redaxo-Artikel via Datenbank \/ Metadaten *\/\n            if (($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'article') || ($hit['type'] == 'article')) {\n                if ($article = rex_article::get($hit['fid'])) {\n                    $searchitem_fragment = new Fragment();\n                    $searchitem_fragment->setVar('type', 'rex_article');\n                    $searchitem_fragment->setVar('title', $article->getName());\n                    $searchitem_fragment->setVar('url', $article->getUrl());\n                    $searchitem_fragment->setVar('teaser', $text);\n                    $searchitem_fragment->setVar('icon', false);\n                    $searchitem_fragment->setVar('extension', false);\n                    $searchitem_fragment->setVar('thumbnail', '\/media\/search_it-result-default.svg');\n                    $searchitem_fragment->setVar('label', '');\n\n                    echo $searchitem_fragment->parse('search-result-item.tpl.php');\n                }\n                        \n                \/* Medium \u00fcber Treffer in Datenbanktabelle rex_media *\/\n                \/* Todo: Nur f\u00fcr Suche indexierte Dateien freigeben *\/\n            } elseif (($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'media') || ($hit['type'] == 'media')) {\n                if ($media = rex_media::get($hit['values']['originalname'])) {\n                    $searchitem_fragment = new Fragment();\n                    $searchitem_fragment->setVar('type', 'rex_media');\n                    $searchitem_fragment->setVar('title', $media->getTitle());\n                    $searchitem_fragment->setVar('url', 'download\/'.$media->getFileName());\n                    $searchitem_fragment->setVar('teaser', $hit['highlightedtext']);\n                    $searchitem_fragment->setVar('extension', $media->getExtension());\n                    $searchitem_fragment->setVar('icon', 'file');\n                    $searchitem_fragment->setVar('thumbnail', false);\n                    $searchitem_fragment->setVar('label', '');\n                            \n                    echo $download_fragment->parse('search-result-item.tpl.php');\n                }\n                        \n                \/* AG-Treffer *\/\n            } elseif (($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'school_projects')) {\n                $searchitem_fragment = new Fragment();\n                $searchitem_fragment->setVar('type', 'school_projects');\n                $searchitem_fragment->setVar('title', $hit['name']);\n                $searchitem_fragment->setVar('url', $article->getUrl());\n                $searchitem_fragment->setVar('teaser', $hit['description']);\n                $searchitem_fragment->setVar('icon', 'schoool_project');\n                $searchitem_fragment->setVar('extension', false);\n                $searchitem_fragment->setVar('thumbnail', $hit['image']);\n                $searchitem_fragment->setVar('label', 'GTB');\n                            \n                echo $searchitem_fragment->parse('search-result-item.tpl.php');\n                            \n                \/* Termin-Treffer *\/\n            } elseif (($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'school_events')) {\n                $searchitem_fragment = new Fragment();\n                $searchitem_fragment->setVar('type', 'school_events');\n                $searchitem_fragment->setVar('title', $hit['name']);\n                $searchitem_fragment->setVar('url', rex_getUrl('', '', ['event-id' => $hit['fid']]));\n                $searchitem_fragment->setVar('teaser', $text);\n                $searchitem_fragment->setVar('icon', 'school_event');\n                $searchitem_fragment->setVar('extension', false);\n                $searchitem_fragment->setVar('thumbnail', false);\n                $searchitem_fragment->setVar('label', 'Veranstaltung');\n                            \n                echo $searchitem_fragment->parse('search-result-item.tpl.php');\n                        \n                \/* Ansprechpartner-Treffer *\/\n            } elseif (($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'school_team')) {\n                $thumbnail = '';\n                if (!$thumbnail = $hit['values']['Bild']) {\n                    $thumbnail = '\/media\/team-person-default.jpg';\n                }\n                            \n                $searchitem_fragment = new Fragment();\n                $searchitem_fragment->setVar('type', 'school_team');\n                $searchitem_fragment->setVar('title', $hit['values']['name']);\n                $searchitem_fragment->setVar('url', rex_getUrl('', '', ['team-id' => $hit['fid']]));\n                $searchitem_fragment->setVar('teaser', $text);\n                $searchitem_fragment->setVar('icon', false);\n                $searchitem_fragment->setVar('extension', false);\n                $searchitem_fragment->setVar('thumbnail', $thumbnail);\n                $searchitem_fragment->setVar('label', 'Ansprechpartner');\n                            \n                echo $searchitem_fragment->parse('search-result-item.tpl.php');\n            } elseif (($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'school_rooms')) {\n                $searchitem_fragment = new Fragment();\n                $searchitem_fragment->setVar('type', 'school_rooms');\n                $searchitem_fragment->setVar('title', $hit['values']['name']);\n                $searchitem_fragment->setVar('url', rex_getUrl('', '', ['room-id' => $hit['fid']]));\n                $searchitem_fragment->setVar('teaser', $hit['values']['title']);\n                $searchitem_fragment->setVar('icon', 'school_room');\n                $searchitem_fragment->setVar('extension', false);\n                $searchitem_fragment->setVar('thumbnail', 'room');\n                $searchitem_fragment->setVar('label', 'Raumplan');\n                            \n                echo $searchitem_fragment->parse('search-result-item.tpl.php');\n            } elseif (($hit['type'] == 'db_column' and $hit['table'] == rex::getTablePrefix().'school_courses')) {\n                $searchitem_fragment = new Fragment();\n                $searchitem_fragment->setVar('type', 'school_courses');\n                $searchitem_fragment->setVar('title', $hit['values']['name']);\n                $searchitem_fragment->setVar('url', rex_getUrl('', '', ['course-id' => $hit['fid']]));\n                $searchitem_fragment->setVar('teaser', $hit['description']);\n                $searchitem_fragment->setVar('icon', 'school_courses');\n                $searchitem_fragment->setVar('extension', false);\n                $searchitem_fragment->setVar('thumbnail', 'course');\n                $searchitem_fragment->setVar('label', 'Fach');\n                            \n                echo $searchitem_fragment->parse('search-result-item.tpl.php');\n            }\n        } \/\/ foreach($result['hits'] as $hit) END\n        echo '<\/ul>';\n    } elseif (!$result['count']) { \/\/ Wenn keine Ergebnisse vorhanden sind....\n        echo '<p class=\"search_it-no_result\">Die Suche nach <i class=\"search_it-request\">'.$request.' <\/i> ergab keine Treffer.<\/p>';\n    }\n} \/\/ if($request) END\n?>\n<\/section>\n","input":"<?php\r\n\r\n\/**\r\n * Dieses Modul wird \u00fcber das Addon plus_bs5 verwaltet und geupdatet.\r\n * Um das Modul zu entkoppeln, \u00e4ndere den Modul-Key in REDAXO. Um die \r\n * Ausgabe zu ver\u00e4ndern, gen\u00fcgt es, das passende Fragment zu \u00fcberschreiben.\r\n *\/\r\n\r\nuse Alexplusde\\BS5\\Helper;\r\n\r\n\/* Ben\u00f6tigte Addons *\/\r\n$requiredAddons = ['search_it'];\r\nif (!Helper::packageExists($requiredAddons)) {\r\n    echo rex_view::error(rex_i18n::rawMsg('bs5_missing_addon', implode(', ', $requiredAddons)));\r\n    return;\r\n};\r\n\r\n\/* Instruktionen *\/\r\nHelper::showBackendUserInstruction(\"F\u00fcr die Suchfunktion wird ein aktueller Index der Seite im Add-on 'search_it' ben\u00f6tigt.\", Helper::getBackendPageLink('search_it'));\r\n","createdate":"2017-01-26 12:46:12","createuser":"aw@alexplus.de","updatedate":"2024-12-11 02:04:54","updateuser":"mail@alexplus.de","attributes":"","revision":0}